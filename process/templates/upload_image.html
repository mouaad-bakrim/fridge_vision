{% extends "base/base.html" %}
{% load rest_framework %}
{% load static %}


{% block title %}

Liste des Documents
{% endblock %}

{% block css %}


{% endblock css %}


{% block toolbar %}


<!--begin::Toolbar-->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<div id="kt_app_toolbar" class="app-toolbar py-2 py-lg-4">
	<!--begin::Toolbar container-->
	<div id="kt_app_toolbar_container" class="app-container container-fluid d-flex flex-stack">
		<!--begin::Page title-->
		<div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
			<!--begin::Title-->
			<h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">
				Multipurpose</h1>
			<!--end::Title-->
			<!--begin::Breadcrumb-->
			<ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
				<!--begin::Item-->
				<li class="breadcrumb-item text-muted">
					<a href="index.html" class="text-muted text-hover-primary">Home</a>
				</li>
				<!--end::Item-->
				<!--begin::Item-->
				<li class="breadcrumb-item">
					<span class="bullet bg-gray-500 w-5px h-2px"></span>
				</li>
				<!--end::Item-->
				<!--begin::Item-->
				<li class="breadcrumb-item text-muted">Upload Image</li>
				<!--end::Item-->
			</ul>
			<!--end::Breadcrumb-->
		</div>
		<!--end::Page title-->
		<!--begin::Actions-->
		<form method="post" id="upload_form" enctype="multipart/form-data">
			{% csrf_token %}
			<div class="d-flex align-items-center ">
				<!--begin::Secondary button-->
				<a class="btn btn-sm fw-bold btn-secondary"> <input type="file" id="upload_file" name="image">
					Upload Image</a>
				<!--end::Secondary button-->
				<!--begin::Primary button-->
				
				
				<button type="submit" class="btn btn-primary" style="margin-left: 10px">Send</button>
				<!--end::Primary button-->
			</div>
			<!--end::Actions-->
		</form>
	</div>
	
	<!--end::Toolbar container-->
</div>
<!--end::Toolbar-->


{% endblock %}


{% block content %}


<!--begin::Row-->
<div class="row gx-5 gx-xl-10 mb-2" style="height:500px">
	<!--begin::Col-->
	<div class="col-xl-4 mb-5 mb-xl-0">
		<!--begin::Chart widget 31-->
		<div class="card card-flush h-xl-100">
			<!--begin::Header-->
			<div class="card-header ">
				<!--begin::Title-->
				<h3 class="card-title align-items-start flex-column">
					<span class="card-label fw-bold text-gray-800">Warephase stats</span>
				
				</h3>
				<!--end::Title-->
				<!--begin::Toolbar-->
				
				<!--end::Toolbar-->
			</div>
			<!--end::Header-->
			<!--begin::Body-->
			<div class="card-body d-flex align-items-center justify-content-center pt-0">
				<!--begin::Chart-->
				<div class="error_msg"></div>
				
				<div id="detections">
					{% if img_obj %}
					<div class="text-center"> <!-- Ajoutez une classe pour centrer le contenu -->
						<img src="{{ img_obj.image.url }}" alt="Image uploaded" class="img-fluid"/>
						<!-- Ajoutez img-fluid pour une image responsive -->
					</div>
					{% endif %}
				
				</div>
				<!--end::Chart-->
			</div>
			<!--end::Body-->
			
			<!--end::Body-->
		</div>
		<!--end::Chart widget 31-->
	</div>
	<!--end::Col-->
	<!--begin::Col-->
	<div class="col-xl-8">
		<!--begin::Chart widget 24-->
		<div class="card card-flush overflow-hidden h-xl-100">
			<!--begin::Header-->
			<div class="card-header py-5">
				<!--begin::Title-->
				<h3 class="card-title align-items-start flex-column">
					<span class="card-label fw-bold text-gray-900">Detections</span>
				</h3>
				<!--end::Title-->
				<div class="card-toolbar">
					<a href="/saved_models/planogram_results.json" id="downloadBtn" class="btn btn-sm btn-light">Download JSON</a>
				</div>
			</div>
			<!--end::Header-->
			<!--begin::Card body-->
			<div class="scroll h-600px px-2">
				<div id="container"
					 style="font-family: monospace; white-space: pre; padding: 10px; background-color: #f8f9fa; border-radius: 5px; border: 1px solid #dee2e6; overflow: auto;"></div>
				<script>
					fetch('saved_models/planogram_results.json')
					.then(response => response.json())
					.then(data => {
						const jsonContainer = document.getElementById('container');
						jsonContainer.textContent = JSON.stringify(data, null, 4);
					})
					.catch(error => {
						console.error('Error fetching JSON:', error);
						const jsonContainer = document.getElementById('container');
						jsonContainer.textContent = 'Error fetching JSON';
					});
				</script>
<script>
    function downloadFile(url) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'blob';
        xhr.onload = function() {
            var blob = xhr.response;
            var link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'planogram_results.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };
        xhr.onerror = function() {
            console.error('Error fetching JSON:', xhr.statusText);
            alert('Error fetching JSON');
        };
        xhr.send();
    }

    document.getElementById('downloadBtn').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent default link behavior
        downloadFile('/saved_models/planogram_results.json');
    });
</script>



			
			
			</div>
			<!--end::Card body-->
		</div>
		<!--end::Chart widget 24-->
	</div>
	<!--end::Col-->
</div>
<!--end::Row-->


<style>* {margin: 0; padding: 0; box-sizing: border-box;}
                    body {background: #f6f6f6; color: #444; font-family: 'Roboto', sans-serif; font-size: 16px; line-height: 1;}
                    .container {max-width: 1100px; padding: 0 20px; margin:0 auto;}
                    .panel {margin: 100px auto 40px; max-width: 500px; text-align: center;}
                    .button_outer {background: #3a62d8; border-radius:30px; text-align: center; height: 50px; width: 200px; display: inline-block; transition: .2s; position: relative; overflow: hidden;}
                    .btn_upload {padding: 17px 30px 12px; color: #fff; text-align: center; position: relative; display: inline-block; overflow: hidden; z-index: 3; white-space: nowrap;}
                    .btn_upload input {position: absolute; width: 100%; left: 0; top: 0; width: 100%; height: 105%; cursor: pointer; opacity: 0;}
                    .file_uploading {width: 100%; height: 10px; margin-top: 20px; background: #ccc;}
                    .file_uploading .btn_upload {display: none;}
                    .processing_bar {position: absolute; left: 0; top: 0; width: 0; height: 100%; border-radius: 30px; background:#83ccd3; transition: 3s;}
                    .file_uploading .processing_bar {width: 100%;}
                    .success_box {display: none; width: 50px; height: 50px; position: relative;}
                    .success_box:before {content: ''; display: block; width: 9px; height: 18px; border-bottom: 6px solid #fff; border-right: 6px solid #fff; -webkit-transform:rotate(45deg); -moz-transform:rotate(45deg); -ms-transform:rotate(45deg); transform:rotate(45deg); position: absolute; left: 17px; top: 10px;}
                    .file_uploaded .success_box {display: inline-block;}
                    .file_uploaded {margin-top: 0; width: 50px; background:#83ccd3; height: 50px;}
                    .uploaded_file_view {max-width: 300px; margin: 40px auto; text-align: center; position: relative; transition: .2s; opacity: 0; border: 2px solid #ddd; padding: 15px;}
                    .file_remove{width: 30px; height: 30px; border-radius: 50%; display: block; position: absolute; background: #aaa; line-height: 30px; color: #fff; font-size: 12px; cursor: pointer; right: -15px; top: -15px;}
                    .file_remove:hover {background: #222; transition: .1s;}
                    .uploaded_file_view img {max-width: 100%;}
                    .uploaded_file_view.show {opacity: 1;}
                    .error_msg {text-align: center; color: #f00}
</style>
<body>


<script>
	
	
	var btnUpload = $("#upload_file"),
		btnOuter = $(".button_outer");
	btnUpload.on("change", function(e){
		var ext = btnUpload.val().split('.').pop().toLowerCase();
		if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
			$(".error_msg").text("Not an Image...");
		} else {
			$(".error_msg").text("");
			btnOuter.addClass("file_uploading");
			setTimeout(function(){
				btnOuter.addClass("file_uploaded");
			},3000);
			var uploadedFile = URL.createObjectURL(e.target.files[0]);
			setTimeout(function(){
				$("#uploaded_view").append('<img src="'+uploadedFile+'" />').addClass("show");
			},3500);
		}
	});
	$(".file_remove").on("click", function(e){
		$("#uploaded_view").removeClass("show");
		$("#uploaded_view").find("img").remove();
		btnOuter.removeClass("file_uploading");
		btnOuter.removeClass("file_uploaded");
	});
	
	
	  var detections = JSON.parse('{{ detections | escapejs }}');

// Sélectionner l'élément où afficher les résultats
var detectionsDiv = document.getElementById('detections');

// Parcourir les résultats et les afficher dans la div
detections.forEach(function(result) {
var resultDiv = document.createElement('div');
resultDiv.innerHTML = 'Nom: ' + result.name + ', Classe: ' + result.class + ', Confiance: ' + result.confidence;
detectionsDiv.appendChild(resultDiv);
});
</script>


{% endblock content %}


{% block javascript %}

{{ filter.form.media.js }}


{% endblock javascript%}